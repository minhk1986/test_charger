{"remainingRequest":"/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/node_modules/babel-loader/lib/index.js!/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/node_modules/eslint-loader/index.js??ref--13-0!/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/src/services/agvr/agvr-map.js","dependencies":[{"path":"/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/src/services/agvr/agvr-map.js","mtime":1609316939488},{"path":"/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/node_modules/cache-loader/dist/cjs.js","mtime":1609316939616},{"path":"/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/node_modules/babel-loader/lib/index.js","mtime":1609316939572},{"path":"/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/node_modules/eslint-loader/index.js","mtime":1609316939784}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy53ZWFrLW1hcCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9ob21lL3JvYm90aWNzL1R1bmdOVi9hZ3ZfdjJfd3Mvc3JjL2Fndl92Mi93ZWJTZXJ2ZXIvYWd2LWRhc2JvYXJkL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL2hvbWUvcm9ib3RpY3MvVHVuZ05WL2Fndl92Ml93cy9zcmMvYWd2X3YyL3dlYlNlcnZlci9hZ3YtZGFzYm9hcmQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9jbGFzc1ByaXZhdGVGaWVsZEdldCBmcm9tICIvaG9tZS9yb2JvdGljcy9UdW5nTlYvYWd2X3YyX3dzL3NyYy9hZ3ZfdjIvd2ViU2VydmVyL2Fndi1kYXNib2FyZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NQcml2YXRlRmllbGRHZXQiOwppbXBvcnQgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0IGZyb20gIi9ob21lL3JvYm90aWNzL1R1bmdOVi9hZ3ZfdjJfd3Mvc3JjL2Fndl92Mi93ZWJTZXJ2ZXIvYWd2LWRhc2JvYXJkL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc1ByaXZhdGVGaWVsZFNldCI7CmltcG9ydCBST1NMSUIgZnJvbSAicm9zbGliIjsKaW1wb3J0IFZ1ZSBmcm9tICJ2dWUiOwp2YXIgRklYRURfTUFQX0lEID0gIjZkZWZiYmE1LTBmMWYtNGI0My1hMzJlLWEyNDI0N2JhYzdkOCI7Cgp2YXIgX2lkID0gbmV3IFdlYWtNYXAoKTsKCnZhciBfcm9zID0gbmV3IFdlYWtNYXAoKTsKCnZhciBfcm9zVXJsID0gbmV3IFdlYWtNYXAoKTsKCnZhciBfcm9zU3RvcmUgPSBuZXcgV2Vha01hcCgpOwoKdmFyIF9tYXBUb3BpYyA9IG5ldyBXZWFrTWFwKCk7Cgp2YXIgX3NpbVBvc2VUb3BpYyA9IG5ldyBXZWFrTWFwKCk7Cgp2YXIgX3Jvc0Nvbm5lY3QgPSBuZXcgV2Vha01hcCgpOwoKdmFyIF9vblJvc0Nvbm5lY3RlZCA9IG5ldyBXZWFrTWFwKCk7Cgp2YXIgX29uUm9zRGlzY29ubmVjdGVkID0gbmV3IFdlYWtNYXAoKTsKCnZhciBfb25NYXBUb3BpY1JlY2VpdmVkID0gbmV3IFdlYWtNYXAoKTsKCnZhciBBZ3ZyTWFwID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBBZ3ZyTWFwKGlkKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBZ3ZyTWFwKTsKCiAgICBfaWQuc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBudWxsCiAgICB9KTsKCiAgICBfcm9zLnNldCh0aGlzLCB7CiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogbnVsbAogICAgfSk7CgogICAgX3Jvc1VybC5zZXQodGhpcywgewogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgdmFsdWU6IG51bGwKICAgIH0pOwoKICAgIF9yb3NTdG9yZS5zZXQodGhpcywgewogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgdmFsdWU6IG51bGwKICAgIH0pOwoKICAgIF9tYXBUb3BpYy5zZXQodGhpcywgewogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgdmFsdWU6IG51bGwKICAgIH0pOwoKICAgIF9zaW1Qb3NlVG9waWMuc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBudWxsCiAgICB9KTsKCiAgICBfcm9zQ29ubmVjdC5zZXQodGhpcywgewogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZFNldChfdGhpcywgX3JvcywgbmV3IFJPU0xJQi5Sb3MoewogICAgICAgICAgdXJsOiBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9yb3NVcmwpCiAgICAgICAgfSkpOwoKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9yb3MpLm9uKCJjb25uZWN0aW9uIiwgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfb25Sb3NDb25uZWN0ZWQpKTsKCiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfcm9zKS5vbigiY2xvc2UiLCBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9vblJvc0Rpc2Nvbm5lY3RlZCkpOwoKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9yb3MpLm9uKCJlcnJvciIsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZXR1cm4gY29uc29sZS5sb2coIkFHVlIgZXJyb3I6ICIsIGUpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICBfb25Sb3NDb25uZWN0ZWQuc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRTZXQoX3RoaXMsIF9tYXBUb3BpYywgbmV3IFJPU0xJQi5Ub3BpYyh7CiAgICAgICAgICByb3M6IF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX3JvcyksCiAgICAgICAgICBuYW1lOiAiL21hcCIsCiAgICAgICAgICBtZXNzYWdlVHlwZTogIm5hdl9tc2dzL09jY3VwYW5jeUdyaWQiCiAgICAgICAgfSkpOwoKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9tYXBUb3BpYykuc3Vic2NyaWJlKF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX29uTWFwVG9waWNSZWNlaXZlZCkpOwoKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9yb3NTdG9yZSkuY29tbWl0KCJhZ3ZNYXBzL3NldENvbm5lY3Rpb25TdGF0ZSIsIHsKICAgICAgICAgIGlkOiBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9pZCksCiAgICAgICAgICBpc0Nvbm5lY3RlZDogdHJ1ZQogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICBfb25Sb3NEaXNjb25uZWN0ZWQuc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICBpZiAoX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfbWFwVG9waWMpICE9IG51bGwpIHsKICAgICAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZFNldChfdGhpcywgX21hcFRvcGljLCBudWxsKTsKCiAgICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9yb3NTdG9yZSkuY29tbWl0KCJhZ3ZNYXBzL3NldENvbm5lY3Rpb25TdGF0ZSIsIHsKICAgICAgICAgICAgaWQ6IF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX2lkKSwKICAgICAgICAgICAgaXNDb25uZWN0ZWQ6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgc2V0VGltZW91dChfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9yb3NDb25uZWN0KSwgMzAwMCk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9vbk1hcFRvcGljUmVjZWl2ZWQuc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShtYXApIHsKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9yb3NTdG9yZSkuY29tbWl0KCJhZ3ZNYXBzL3NldFJvc01hcCIsIHsKICAgICAgICAgIGlkOiBGSVhFRF9NQVBfSUQsCiAgICAgICAgICBtYXA6IG1hcAogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICBfY2xhc3NQcml2YXRlRmllbGRTZXQodGhpcywgX2lkLCBpZCk7CgogICAgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KHRoaXMsIF9yb3NTdG9yZSwgVnVlLnByb3RvdHlwZS4kc3RvcmUpOwoKICAgIF9jbGFzc1ByaXZhdGVGaWVsZFNldCh0aGlzLCBfcm9zVXJsLCBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX3Jvc1N0b3JlKS5zdGF0ZS5hZ3ZNYXBzLmZpbmQoZnVuY3Rpb24gKG0pIHsKICAgICAgcmV0dXJuIG0uaWQgPT09IF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX2lkKTsKICAgIH0pLnJvc01hc3RlclVyaSk7CgogICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9yb3NDb25uZWN0KS5jYWxsKHRoaXMpOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEFndnJNYXAsIFt7CiAgICBrZXk6ICJkaXNwb3NlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNwb3NlKCkgewogICAgICBfY2xhc3NQcml2YXRlRmllbGRTZXQodGhpcywgX21hcFRvcGljLCBudWxsKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBBZ3ZyTWFwOwp9KCk7CgpleHBvcnQgeyBBZ3ZyTWFwIGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/src/services/agvr/agvr-map.js"],"names":["ROSLIB","Vue","FIXED_MAP_ID","AgvrMap","id","Ros","url","on","e","console","log","Topic","ros","name","messageType","subscribe","commit","isConnected","setTimeout","map","prototype","$store","state","agvMaps","find","m","rosMasterUri"],"mappings":";;;;;;;;;AAAA,OAAOA,MAAP,MAAmB,QAAnB;AACA,OAAOC,GAAP,MAAgB,KAAhB;AAEA,IAAMC,YAAY,GAAG,sCAArB;;;;;;;;;;;;;;;;;;;;;;IAEqBC,O;AAQnB,mBAAYC,EAAZ,EAAgB;AAAA;;AAAA;;AAAA;AAAA;AAAA,aAPV;AAOU;;AAAA;AAAA;AAAA,aANT;AAMS;;AAAA;AAAA;AAAA,aALN;AAKM;;AAAA;AAAA;AAAA,aAJJ;AAII;;AAAA;AAAA;AAAA,aAHJ;AAGI;;AAAA;AAAA;AAAA,aAFA;AAEA;;AAAA;AAAA;AAAA,aAOF,iBAAM;AAClB,8BAAA,KAAI,QAAQ,IAAIJ,MAAM,CAACK,GAAX,CAAe;AAAEC,UAAAA,GAAG,wBAAE,KAAF;AAAL,SAAf,CAAR,CAAJ;;AACA,8BAAA,KAAI,OAAJ,CAAUC,EAAV,CAAa,YAAb,wBAA2B,KAA3B;;AACA,8BAAA,KAAI,OAAJ,CAAUA,EAAV,CAAa,OAAb,wBAAsB,KAAtB;;AACA,8BAAA,KAAI,OAAJ,CAAUA,EAAV,CAAa,OAAb,EAAsB,UAACC,CAAD;AAAA,iBAAOC,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4BF,CAA5B,CAAP;AAAA,SAAtB;AACD;AAZe;;AAAA;AAAA;AAAA,aAcE,iBAAM;AACtB,8BAAA,KAAI,aAAa,IAAIR,MAAM,CAACW,KAAX,CAAiB;AAChCC,UAAAA,GAAG,wBAAE,KAAF,OAD6B;AAEhCC,UAAAA,IAAI,EAAE,MAF0B;AAGhCC,UAAAA,WAAW,EAAE;AAHmB,SAAjB,CAAb,CAAJ;;AAKA,8BAAA,KAAI,YAAJ,CAAeC,SAAf,uBAAyB,KAAzB;;AACA,8BAAA,KAAI,YAAJ,CAAeC,MAAf,CAAsB,4BAAtB,EAAoD;AAClDZ,UAAAA,EAAE,wBAAE,KAAF,MADgD;AAElDa,UAAAA,WAAW,EAAE;AAFqC,SAApD;AAID;AAzBe;;AAAA;AAAA;AAAA,aA2BK,iBAAM;AACzB,YAAI,sBAAA,KAAI,YAAJ,IAAkB,IAAtB,EAA4B;AAC1B,gCAAA,KAAI,aAAa,IAAb,CAAJ;;AACA,gCAAA,KAAI,YAAJ,CAAeD,MAAf,CAAsB,4BAAtB,EAAoD;AAClDZ,YAAAA,EAAE,wBAAE,KAAF,MADgD;AAElDa,YAAAA,WAAW,EAAE;AAFqC,WAApD;AAID;;AACDC,QAAAA,UAAU,uBAAC,KAAD,gBAAmB,IAAnB,CAAV;AACD;AApCe;;AAAA;AAAA;AAAA,aA0CM,eAACC,GAAD,EAAS;AAC7B,8BAAA,KAAI,YAAJ,CAAeH,MAAf,CAAsB,mBAAtB,EAA2C;AAAEZ,UAAAA,EAAE,EAAEF,YAAN;AAAoBiB,UAAAA,GAAG,EAAHA;AAApB,SAA3C;AACD;AA5Ce;;AACd,qCAAWf,EAAX;;AACA,2CAAiBH,GAAG,CAACmB,SAAJ,CAAcC,MAA/B;;AACA,yCAAe,uCAAeC,KAAf,CAAqBC,OAArB,CAA6BC,IAA7B,CAAkC,UAACC,CAAD;AAAA,aAAOA,CAAC,CAACrB,EAAF,2BAAS,KAAT,MAAP;AAAA,KAAlC,EAA4DsB,YAA3E;;AACA;AACD;;;;8BAiCS;AACR,6CAAiB,IAAjB;AACD;;;;;;SAhDkBvB,O","sourcesContent":["import ROSLIB from \"roslib\";\nimport Vue from \"vue\";\n\nconst FIXED_MAP_ID = \"6defbba5-0f1f-4b43-a32e-a24247bac7d8\";\n\nexport default class AgvrMap {\n  #id = null;\n  #ros = null;\n  #rosUrl = null;\n  #rosStore = null;\n  #mapTopic = null;\n  #simPoseTopic = null;\n\n  constructor(id) {\n    this.#id = id;\n    this.#rosStore = Vue.prototype.$store;\n    this.#rosUrl = this.#rosStore.state.agvMaps.find((m) => m.id === this.#id).rosMasterUri;\n    this.#rosConnect();\n  }\n\n  #rosConnect = () => {\n    this.#ros = new ROSLIB.Ros({ url: this.#rosUrl });\n    this.#ros.on(\"connection\", this.#onRosConnected);\n    this.#ros.on(\"close\", this.#onRosDisconnected);\n    this.#ros.on(\"error\", (e) => console.log(\"AGVR error: \", e));\n  }\n\n  #onRosConnected = () => {\n    this.#mapTopic = new ROSLIB.Topic({\n      ros: this.#ros,\n      name: \"/map\",\n      messageType: \"nav_msgs/OccupancyGrid\",\n    });\n    this.#mapTopic.subscribe(this.#onMapTopicReceived);\n    this.#rosStore.commit(\"agvMaps/setConnectionState\", {\n      id: this.#id,\n      isConnected: true,\n    })\n  }\n\n  #onRosDisconnected = () => {\n    if (this.#mapTopic != null) {\n      this.#mapTopic = null;\n      this.#rosStore.commit(\"agvMaps/setConnectionState\", {\n        id: this.#id,\n        isConnected: true,\n      })\n    }\n    setTimeout(this.#rosConnect, 3000);\n  }\n\n  dispose() {\n    this.#mapTopic = null;\n  }\n\n  #onMapTopicReceived = (map) => {\n    this.#rosStore.commit(\"agvMaps/setRosMap\", { id: FIXED_MAP_ID, map, });\n  }\n}"]}]}