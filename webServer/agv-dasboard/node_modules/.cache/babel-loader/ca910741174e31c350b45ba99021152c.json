{"remainingRequest":"/home/robotics/AnhNV/agv-dasboard/node_modules/babel-loader/lib/index.js!/home/robotics/AnhNV/agv-dasboard/node_modules/eslint-loader/index.js??ref--13-0!/home/robotics/AnhNV/agv-dasboard/src/services/agvr/agvr-map.js","dependencies":[{"path":"/home/robotics/AnhNV/agv-dasboard/src/services/agvr/agvr-map.js","mtime":1609149483160},{"path":"/home/robotics/AnhNV/agv-dasboard/node_modules/cache-loader/dist/cjs.js","mtime":1602053610278},{"path":"/home/robotics/AnhNV/agv-dasboard/node_modules/babel-loader/lib/index.js","mtime":1602053610019},{"path":"/home/robotics/AnhNV/agv-dasboard/node_modules/eslint-loader/index.js","mtime":1602053618906}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy53ZWFrLW1hcCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9ob21lL3JvYm90aWNzL0FuaE5WL2Fndi1kYXNib2FyZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIi9ob21lL3JvYm90aWNzL0FuaE5WL2Fndi1kYXNib2FyZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0IGZyb20gIi9ob21lL3JvYm90aWNzL0FuaE5WL2Fndi1kYXNib2FyZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NQcml2YXRlRmllbGRHZXQiOwppbXBvcnQgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0IGZyb20gIi9ob21lL3JvYm90aWNzL0FuaE5WL2Fndi1kYXNib2FyZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NQcml2YXRlRmllbGRTZXQiOwppbXBvcnQgUk9TTElCIGZyb20gInJvc2xpYiI7CmltcG9ydCBWdWUgZnJvbSAidnVlIjsKdmFyIEZJWEVEX01BUF9JRCA9ICI2ZGVmYmJhNS0wZjFmLTRiNDMtYTMyZS1hMjQyNDdiYWM3ZDgiOwoKdmFyIF9pZCA9IG5ldyBXZWFrTWFwKCk7Cgp2YXIgX3JvcyA9IG5ldyBXZWFrTWFwKCk7Cgp2YXIgX3Jvc1VybCA9IG5ldyBXZWFrTWFwKCk7Cgp2YXIgX3Jvc1N0b3JlID0gbmV3IFdlYWtNYXAoKTsKCnZhciBfbWFwVG9waWMgPSBuZXcgV2Vha01hcCgpOwoKdmFyIF9zaW1Qb3NlVG9waWMgPSBuZXcgV2Vha01hcCgpOwoKdmFyIF9yb3NDb25uZWN0ID0gbmV3IFdlYWtNYXAoKTsKCnZhciBfb25Sb3NDb25uZWN0ZWQgPSBuZXcgV2Vha01hcCgpOwoKdmFyIF9vblJvc0Rpc2Nvbm5lY3RlZCA9IG5ldyBXZWFrTWFwKCk7Cgp2YXIgX29uTWFwVG9waWNSZWNlaXZlZCA9IG5ldyBXZWFrTWFwKCk7Cgp2YXIgQWd2ck1hcCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gQWd2ck1hcChpZCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQWd2ck1hcCk7CgogICAgX2lkLnNldCh0aGlzLCB7CiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogbnVsbAogICAgfSk7CgogICAgX3Jvcy5zZXQodGhpcywgewogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgdmFsdWU6IG51bGwKICAgIH0pOwoKICAgIF9yb3NVcmwuc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBudWxsCiAgICB9KTsKCiAgICBfcm9zU3RvcmUuc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBudWxsCiAgICB9KTsKCiAgICBfbWFwVG9waWMuc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBudWxsCiAgICB9KTsKCiAgICBfc2ltUG9zZVRvcGljLnNldCh0aGlzLCB7CiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogbnVsbAogICAgfSk7CgogICAgX3Jvc0Nvbm5lY3Quc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRTZXQoX3RoaXMsIF9yb3MsIG5ldyBST1NMSUIuUm9zKHsKICAgICAgICAgIHVybDogX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfcm9zVXJsKQogICAgICAgIH0pKTsKCiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfcm9zKS5vbigiY29ubmVjdGlvbiIsIF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX29uUm9zQ29ubmVjdGVkKSk7CgogICAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX3Jvcykub24oImNsb3NlIiwgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfb25Sb3NEaXNjb25uZWN0ZWQpKTsKCiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfcm9zKS5vbigiZXJyb3IiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgcmV0dXJuIGNvbnNvbGUubG9nKCJBR1ZSIGVycm9yOiAiLCBlKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CgogICAgX29uUm9zQ29ubmVjdGVkLnNldCh0aGlzLCB7CiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KF90aGlzLCBfbWFwVG9waWMsIG5ldyBST1NMSUIuVG9waWMoewogICAgICAgICAgcm9zOiBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9yb3MpLAogICAgICAgICAgbmFtZTogIi9tYXAiLAogICAgICAgICAgbWVzc2FnZVR5cGU6ICJuYXZfbXNncy9PY2N1cGFuY3lHcmlkIgogICAgICAgIH0pKTsKCiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfbWFwVG9waWMpLnN1YnNjcmliZShfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9vbk1hcFRvcGljUmVjZWl2ZWQpKTsKCiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfcm9zU3RvcmUpLmNvbW1pdCgiYWd2TWFwcy9zZXRDb25uZWN0aW9uU3RhdGUiLCB7CiAgICAgICAgICBpZDogX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfaWQpLAogICAgICAgICAgaXNDb25uZWN0ZWQ6IHRydWUKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CgogICAgX29uUm9zRGlzY29ubmVjdGVkLnNldCh0aGlzLCB7CiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgaWYgKF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX21hcFRvcGljKSAhPSBudWxsKSB7CiAgICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRTZXQoX3RoaXMsIF9tYXBUb3BpYywgbnVsbCk7CgogICAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfcm9zU3RvcmUpLmNvbW1pdCgiYWd2TWFwcy9zZXRDb25uZWN0aW9uU3RhdGUiLCB7CiAgICAgICAgICAgIGlkOiBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9pZCksCiAgICAgICAgICAgIGlzQ29ubmVjdGVkOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHNldFRpbWVvdXQoX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfcm9zQ29ubmVjdCksIDMwMDApOwogICAgICB9CiAgICB9KTsKCiAgICBfb25NYXBUb3BpY1JlY2VpdmVkLnNldCh0aGlzLCB7CiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUobWFwKSB7CiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfcm9zU3RvcmUpLmNvbW1pdCgiYWd2TWFwcy9zZXRSb3NNYXAiLCB7CiAgICAgICAgICBpZDogRklYRURfTUFQX0lELAogICAgICAgICAgbWFwOiBtYXAKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CgogICAgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KHRoaXMsIF9pZCwgaWQpOwoKICAgIF9jbGFzc1ByaXZhdGVGaWVsZFNldCh0aGlzLCBfcm9zU3RvcmUsIFZ1ZS5wcm90b3R5cGUuJHN0b3JlKTsKCiAgICBfY2xhc3NQcml2YXRlRmllbGRTZXQodGhpcywgX3Jvc1VybCwgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9yb3NTdG9yZSkuc3RhdGUuYWd2TWFwcy5maW5kKGZ1bmN0aW9uIChtKSB7CiAgICAgIHJldHVybiBtLmlkID09PSBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9pZCk7CiAgICB9KS5yb3NNYXN0ZXJVcmkpOwoKICAgIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfcm9zQ29ubmVjdCkuY2FsbCh0aGlzKTsKICB9CgogIF9jcmVhdGVDbGFzcyhBZ3ZyTWFwLCBbewogICAga2V5OiAiZGlzcG9zZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGlzcG9zZSgpIHsKICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KHRoaXMsIF9tYXBUb3BpYywgbnVsbCk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gQWd2ck1hcDsKfSgpOwoKZXhwb3J0IHsgQWd2ck1hcCBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["/home/robotics/AnhNV/agv-dasboard/src/services/agvr/agvr-map.js"],"names":["ROSLIB","Vue","FIXED_MAP_ID","AgvrMap","id","Ros","url","on","e","console","log","Topic","ros","name","messageType","subscribe","commit","isConnected","setTimeout","map","prototype","$store","state","agvMaps","find","m","rosMasterUri"],"mappings":";;;;;;;;;AAAA,OAAOA,MAAP,MAAmB,QAAnB;AACA,OAAOC,GAAP,MAAgB,KAAhB;AAEA,IAAMC,YAAY,GAAG,sCAArB;;;;;;;;;;;;;;;;;;;;;;IAEqBC,O;AAQnB,mBAAYC,EAAZ,EAAgB;AAAA;;AAAA;;AAAA;AAAA;AAAA,aAPV;AAOU;;AAAA;AAAA;AAAA,aANT;AAMS;;AAAA;AAAA;AAAA,aALN;AAKM;;AAAA;AAAA;AAAA,aAJJ;AAII;;AAAA;AAAA;AAAA,aAHJ;AAGI;;AAAA;AAAA;AAAA,aAFA;AAEA;;AAAA;AAAA;AAAA,aAOF,iBAAM;AAClB,8BAAA,KAAI,QAAQ,IAAIJ,MAAM,CAACK,GAAX,CAAe;AAAEC,UAAAA,GAAG,wBAAE,KAAF;AAAL,SAAf,CAAR,CAAJ;;AACA,8BAAA,KAAI,OAAJ,CAAUC,EAAV,CAAa,YAAb,wBAA2B,KAA3B;;AACA,8BAAA,KAAI,OAAJ,CAAUA,EAAV,CAAa,OAAb,wBAAsB,KAAtB;;AACA,8BAAA,KAAI,OAAJ,CAAUA,EAAV,CAAa,OAAb,EAAsB,UAACC,CAAD;AAAA,iBAAOC,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4BF,CAA5B,CAAP;AAAA,SAAtB;AACD;AAZe;;AAAA;AAAA;AAAA,aAcE,iBAAM;AACtB,8BAAA,KAAI,aAAa,IAAIR,MAAM,CAACW,KAAX,CAAiB;AAChCC,UAAAA,GAAG,wBAAE,KAAF,OAD6B;AAEhCC,UAAAA,IAAI,EAAE,MAF0B;AAGhCC,UAAAA,WAAW,EAAE;AAHmB,SAAjB,CAAb,CAAJ;;AAKA,8BAAA,KAAI,YAAJ,CAAeC,SAAf,uBAAyB,KAAzB;;AACA,8BAAA,KAAI,YAAJ,CAAeC,MAAf,CAAsB,4BAAtB,EAAoD;AAClDZ,UAAAA,EAAE,wBAAE,KAAF,MADgD;AAElDa,UAAAA,WAAW,EAAE;AAFqC,SAApD;AAID;AAzBe;;AAAA;AAAA;AAAA,aA2BK,iBAAM;AACzB,YAAI,sBAAA,KAAI,YAAJ,IAAkB,IAAtB,EAA4B;AAC1B,gCAAA,KAAI,aAAa,IAAb,CAAJ;;AACA,gCAAA,KAAI,YAAJ,CAAeD,MAAf,CAAsB,4BAAtB,EAAoD;AAClDZ,YAAAA,EAAE,wBAAE,KAAF,MADgD;AAElDa,YAAAA,WAAW,EAAE;AAFqC,WAApD;AAID;;AACDC,QAAAA,UAAU,uBAAC,KAAD,gBAAmB,IAAnB,CAAV;AACD;AApCe;;AAAA;AAAA;AAAA,aA0CM,eAACC,GAAD,EAAS;AAC7B,8BAAA,KAAI,YAAJ,CAAeH,MAAf,CAAsB,mBAAtB,EAA2C;AAAEZ,UAAAA,EAAE,EAAEF,YAAN;AAAoBiB,UAAAA,GAAG,EAAHA;AAApB,SAA3C;AACD;AA5Ce;;AACd,qCAAWf,EAAX;;AACA,2CAAiBH,GAAG,CAACmB,SAAJ,CAAcC,MAA/B;;AACA,yCAAe,uCAAeC,KAAf,CAAqBC,OAArB,CAA6BC,IAA7B,CAAkC,UAACC,CAAD;AAAA,aAAOA,CAAC,CAACrB,EAAF,2BAAS,KAAT,MAAP;AAAA,KAAlC,EAA4DsB,YAA3E;;AACA;AACD;;;;8BAiCS;AACR,6CAAiB,IAAjB;AACD;;;;;;SAhDkBvB,O","sourcesContent":["import ROSLIB from \"roslib\";\nimport Vue from \"vue\";\n\nconst FIXED_MAP_ID = \"6defbba5-0f1f-4b43-a32e-a24247bac7d8\";\n\nexport default class AgvrMap {\n  #id = null;\n  #ros = null;\n  #rosUrl = null;\n  #rosStore = null;\n  #mapTopic = null;\n  #simPoseTopic = null;\n\n  constructor(id) {\n    this.#id = id;\n    this.#rosStore = Vue.prototype.$store;\n    this.#rosUrl = this.#rosStore.state.agvMaps.find((m) => m.id === this.#id).rosMasterUri;\n    this.#rosConnect();\n  }\n\n  #rosConnect = () => {\n    this.#ros = new ROSLIB.Ros({ url: this.#rosUrl });\n    this.#ros.on(\"connection\", this.#onRosConnected);\n    this.#ros.on(\"close\", this.#onRosDisconnected);\n    this.#ros.on(\"error\", (e) => console.log(\"AGVR error: \", e));\n  }\n\n  #onRosConnected = () => {\n    this.#mapTopic = new ROSLIB.Topic({\n      ros: this.#ros,\n      name: \"/map\",\n      messageType: \"nav_msgs/OccupancyGrid\",\n    });\n    this.#mapTopic.subscribe(this.#onMapTopicReceived);\n    this.#rosStore.commit(\"agvMaps/setConnectionState\", {\n      id: this.#id,\n      isConnected: true,\n    })\n  }\n\n  #onRosDisconnected = () => {\n    if (this.#mapTopic != null) {\n      this.#mapTopic = null;\n      this.#rosStore.commit(\"agvMaps/setConnectionState\", {\n        id: this.#id,\n        isConnected: true,\n      })\n    }\n    setTimeout(this.#rosConnect, 3000);\n  }\n\n  dispose() {\n    this.#mapTopic = null;\n  }\n\n  #onMapTopicReceived = (map) => {\n    this.#rosStore.commit(\"agvMaps/setRosMap\", { id: FIXED_MAP_ID, map, });\n  }\n}"]}]}