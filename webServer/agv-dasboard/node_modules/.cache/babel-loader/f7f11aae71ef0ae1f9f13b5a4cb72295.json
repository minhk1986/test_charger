{"remainingRequest":"/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/node_modules/babel-loader/lib/index.js!/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/node_modules/eslint-loader/index.js??ref--13-0!/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/src/services/agvr/agvr-robot.js","dependencies":[{"path":"/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/src/services/agvr/agvr-robot.js","mtime":1609316939488},{"path":"/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/node_modules/cache-loader/dist/cjs.js","mtime":1609316939616},{"path":"/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/node_modules/babel-loader/lib/index.js","mtime":1609316939572},{"path":"/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/node_modules/eslint-loader/index.js","mtime":1609316939784}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMud2Vhay1tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiL2hvbWUvcm9ib3RpY3MvVHVuZ05WL2Fndl92Ml93cy9zcmMvYWd2X3YyL3dlYlNlcnZlci9hZ3YtZGFzYm9hcmQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9ob21lL3JvYm90aWNzL1R1bmdOVi9hZ3ZfdjJfd3Mvc3JjL2Fndl92Mi93ZWJTZXJ2ZXIvYWd2LWRhc2JvYXJkL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL2hvbWUvcm9ib3RpY3MvVHVuZ05WL2Fndl92Ml93cy9zcmMvYWd2X3YyL3dlYlNlcnZlci9hZ3YtZGFzYm9hcmQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9jbGFzc1ByaXZhdGVGaWVsZEdldCBmcm9tICIvaG9tZS9yb2JvdGljcy9UdW5nTlYvYWd2X3YyX3dzL3NyYy9hZ3ZfdjIvd2ViU2VydmVyL2Fndi1kYXNib2FyZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NQcml2YXRlRmllbGRHZXQiOwppbXBvcnQgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0IGZyb20gIi9ob21lL3JvYm90aWNzL1R1bmdOVi9hZ3ZfdjJfd3Mvc3JjL2Fndl92Mi93ZWJTZXJ2ZXIvYWd2LWRhc2JvYXJkL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc1ByaXZhdGVGaWVsZFNldCI7CmltcG9ydCBST1NMSUIgZnJvbSAicm9zbGliIjsKaW1wb3J0IFZ1ZSBmcm9tICJ2dWUiOwppbXBvcnQgQWd2ckRpYWdub3N0aWNzIGZyb20gIi4vYWd2ci1kaWFnbm9zdGljcyI7CmltcG9ydCBBZ3ZyQWN0aW9uIGZyb20gIi4vYWd2ci1hY3Rpb24iOwppbXBvcnQgQWd2clNpbTEwMDBQb3NlIGZyb20gIi4vYWd2ci1zaW0xMDAwLXBvc2UiOwppbXBvcnQgeyBST1MyRCB9IGZyb20gJ0AvdXRpbHMvcm9zJzsKaW1wb3J0ICogYXMgQUdWX0FDVElPTl9TVEFUVVMgZnJvbSAnLi9hZ3YtYWN0aW9uLXN0YXR1cyc7CmltcG9ydCAqIGFzIEFHVl9BQ1RJT04gZnJvbSAiLi9hZ3YtYWN0aW9uLXR5cGUiOwoKdmFyIF9pZCA9IG5ldyBXZWFrTWFwKCk7Cgp2YXIgX2FndiA9IG5ldyBXZWFrTWFwKCk7Cgp2YXIgX21hcElkID0gbmV3IFdlYWtNYXAoKTsKCnZhciBfbWFwID0gbmV3IFdlYWtNYXAoKTsKCnZhciBfcm9zID0gbmV3IFdlYWtNYXAoKTsKCnZhciBfcm9zVXJsID0gbmV3IFdlYWtNYXAoKTsKCnZhciBfcm9zU3RvcmUgPSBuZXcgV2Vha01hcCgpOwoKdmFyIF9hZ3ZyRGlhZ25vc3RpY3MgPSBuZXcgV2Vha01hcCgpOwoKdmFyIF9hZ3ZyQWN0aW9uID0gbmV3IFdlYWtNYXAoKTsKCnZhciBfYWd2clNpbTEwMDBQb3NlID0gbmV3IFdlYWtNYXAoKTsKCnZhciBfdHdpc3RDbWRWZWwgPSBuZXcgV2Vha01hcCgpOwoKdmFyIF90aW1lclB1Ymxpc2hDbWRWZWwgPSBuZXcgV2Vha01hcCgpOwoKdmFyIF9pbnRlcnZhbFB1c2ggPSBuZXcgV2Vha01hcCgpOwoKdmFyIF9yb3NDb25uZWN0ID0gbmV3IFdlYWtNYXAoKTsKCnZhciBfb25Sb3NDb25uZWN0ZWQgPSBuZXcgV2Vha01hcCgpOwoKdmFyIF9vblJvc0Rpc2Nvbm5lY3RlZCA9IG5ldyBXZWFrTWFwKCk7Cgp2YXIgQWd2clJvYm90ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBBZ3ZyUm9ib3QoaWQsIG1hcElkKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBZ3ZyUm9ib3QpOwoKICAgIF9pZC5zZXQodGhpcywgewogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgdmFsdWU6IG51bGwKICAgIH0pOwoKICAgIF9hZ3Yuc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBudWxsCiAgICB9KTsKCiAgICBfbWFwSWQuc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBudWxsCiAgICB9KTsKCiAgICBfbWFwLnNldCh0aGlzLCB7CiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogbnVsbAogICAgfSk7CgogICAgX3Jvcy5zZXQodGhpcywgewogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgdmFsdWU6IG51bGwKICAgIH0pOwoKICAgIF9yb3NVcmwuc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBudWxsCiAgICB9KTsKCiAgICBfcm9zU3RvcmUuc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBudWxsCiAgICB9KTsKCiAgICBfYWd2ckRpYWdub3N0aWNzLnNldCh0aGlzLCB7CiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogbnVsbAogICAgfSk7CgogICAgX2FndnJBY3Rpb24uc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiBudWxsCiAgICB9KTsKCiAgICBfYWd2clNpbTEwMDBQb3NlLnNldCh0aGlzLCB7CiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogbnVsbAogICAgfSk7CgogICAgX3R3aXN0Q21kVmVsLnNldCh0aGlzLCB7CiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogbnVsbAogICAgfSk7CgogICAgX3RpbWVyUHVibGlzaENtZFZlbC5zZXQodGhpcywgewogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgdmFsdWU6IG51bGwKICAgIH0pOwoKICAgIF9pbnRlcnZhbFB1c2guc2V0KHRoaXMsIHsKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIHZhbHVlOiAxMDAKICAgIH0pOwoKICAgIF9yb3NDb25uZWN0LnNldCh0aGlzLCB7CiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KF90aGlzLCBfcm9zLCBuZXcgUk9TTElCLlJvcyh7CiAgICAgICAgICB1cmw6IF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX3Jvc1VybCkKICAgICAgICB9KSk7CgogICAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX3Jvcykub24oImNvbm5lY3Rpb24iLCBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9vblJvc0Nvbm5lY3RlZCkpOwoKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9yb3MpLm9uKCJjbG9zZSIsIF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX29uUm9zRGlzY29ubmVjdGVkKSk7CgogICAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX3Jvcykub24oImVycm9yIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJldHVybiBjb25zb2xlLmxvZygiQUdWUiBlcnJvcjogIiwgZSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9vblJvc0Nvbm5lY3RlZC5zZXQodGhpcywgewogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkgewogICAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZFNldChfdGhpcywgX2FndnJBY3Rpb24sIG5ldyBBZ3ZyQWN0aW9uKF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX3JvcykpKTsKCiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KF90aGlzLCBfYWd2ckRpYWdub3N0aWNzLCBuZXcgQWd2ckRpYWdub3N0aWNzKF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX3JvcyksIF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX2lkKSkpOwoKICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRTZXQoX3RoaXMsIF9hZ3ZyU2ltMTAwMFBvc2UsIG5ldyBBZ3ZyU2ltMTAwMFBvc2UoX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfcm9zKSwgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfaWQpLCBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9tYXBJZCkpKTsKCiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfcm9zU3RvcmUpLmNvbW1pdCgiYWd2cy9zZXRDb25uZWN0aW9uU3RhdGUiLCB7CiAgICAgICAgICBhZ3ZJZDogX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfaWQpLAogICAgICAgICAgaXNDb25uZWN0ZWQ6IHRydWUKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CgogICAgX29uUm9zRGlzY29ubmVjdGVkLnNldCh0aGlzLCB7CiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgaWYgKF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpcywgX2FndnJEaWFnbm9zdGljcykgIT0gbnVsbCkgewogICAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfYWd2ckRpYWdub3N0aWNzKS5kaXNwb3NlKCk7CgogICAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KF90aGlzLCBfYWd2ckRpYWdub3N0aWNzLCBudWxsKTsKICAgICAgICB9CgogICAgICAgIGlmIChfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9hZ3ZyQWN0aW9uKSAhPSBudWxsKSB7CiAgICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9hZ3ZyQWN0aW9uKS5kaXNwb3NlKCk7CgogICAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KF90aGlzLCBfYWd2ckFjdGlvbiwgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfYWd2clNpbTEwMDBQb3NlKSAhPSBudWxsKSB7CiAgICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9hZ3ZyU2ltMTAwMFBvc2UpLmRpc3Bvc2UoKTsKCiAgICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRTZXQoX3RoaXMsIF9hZ3ZyU2ltMTAwMFBvc2UsIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfcm9zU3RvcmUpLmNvbW1pdCgiYWd2cy9zZXRDb25uZWN0aW9uU3RhdGUiLCB7CiAgICAgICAgICBhZ3ZJZDogX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfaWQpLAogICAgICAgICAgaXNDb25uZWN0ZWQ6IGZhbHNlCiAgICAgICAgfSk7CgogICAgICAgIHNldFRpbWVvdXQoX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KF90aGlzLCBfcm9zQ29ubmVjdCksIDMwMDApOwogICAgICB9CiAgICB9KTsKCiAgICBfY2xhc3NQcml2YXRlRmllbGRTZXQodGhpcywgX2lkLCBpZCk7CgogICAgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KHRoaXMsIF9tYXBJZCwgbWFwSWQpOwoKICAgIF9jbGFzc1ByaXZhdGVGaWVsZFNldCh0aGlzLCBfcm9zU3RvcmUsIFZ1ZS5wcm90b3R5cGUuJHN0b3JlKTsKCiAgICBfY2xhc3NQcml2YXRlRmllbGRTZXQodGhpcywgX21hcCwgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9yb3NTdG9yZSkuc3RhdGUuYWd2TWFwcy5maW5kKGZ1bmN0aW9uIChtKSB7CiAgICAgIHJldHVybiBtLmlkID09PSBtYXBJZDsKICAgIH0pKTsKCiAgICBfY2xhc3NQcml2YXRlRmllbGRTZXQodGhpcywgX2FndiwgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9yb3NTdG9yZSkuc3RhdGUuYWd2cy5maW5kKGZ1bmN0aW9uIChyKSB7CiAgICAgIHJldHVybiByLmlkID09PSBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMsIF9pZCk7CiAgICB9KSk7CgogICAgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KHRoaXMsIF9yb3NVcmwsIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfYWd2KS5yb3NNYXN0ZXJVcmkpOwoKICAgIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfcm9zQ29ubmVjdCkuY2FsbCh0aGlzKTsKICB9CgogIF9jcmVhdGVDbGFzcyhBZ3ZyUm9ib3QsIFt7CiAgICBrZXk6ICJwdXNoQ21kdmVsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcHVzaENtZHZlbCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIodHdpc3QpIHsKICAgICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgICAgdmFyIHNwZWVkOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAoISh0d2lzdCA9PSBudWxsKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgc3BlZWQgPSBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX2FndikucHJvcGVydGllczsKCiAgICAgICAgICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRTZXQodGhpcywgX3R3aXN0Q21kVmVsLCB7CiAgICAgICAgICAgICAgICAgIGxpbmVhcjogewogICAgICAgICAgICAgICAgICAgIHg6IHR3aXN0LmxpbmVhci54ICogc3BlZWQubW92ZW1lbnRTcGVlZC54LAogICAgICAgICAgICAgICAgICAgIHk6IHR3aXN0LmxpbmVhci55ICogc3BlZWQubW92ZW1lbnRTcGVlZC55LAogICAgICAgICAgICAgICAgICAgIHo6IHR3aXN0LmxpbmVhci56ICogc3BlZWQubW92ZW1lbnRTcGVlZC56CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGFuZ3VsYXI6IHsKICAgICAgICAgICAgICAgICAgICB4OiB0d2lzdC5hbmd1bGFyLnggKiBzcGVlZC5yb3RhdGVTcGVlZC54LAogICAgICAgICAgICAgICAgICAgIHk6IHR3aXN0LmFuZ3VsYXIueSAqIHNwZWVkLnJvdGF0ZVNwZWVkLnksCiAgICAgICAgICAgICAgICAgICAgejogdHdpc3QuYW5ndWxhci56ICogc3BlZWQucm90YXRlU3BlZWQuegogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF90aW1lclB1Ymxpc2hDbWRWZWwpICE9IG51bGwpIGNsZWFySW50ZXJ2YWwoX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF90aW1lclB1Ymxpc2hDbWRWZWwpKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hBY3Rpb24oewogICAgICAgICAgICAgICAgICB2YWx1ZTogQUdWX0FDVElPTi5NQU5VQUwsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJnZW9tZXRyeV9tc2dzL1R3aXN0IiwKICAgICAgICAgICAgICAgICAgZGF0YTogX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF90d2lzdENtZFZlbCkKICAgICAgICAgICAgICAgIH0sIGZhbHNlKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgaWYgKF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfdHdpc3RDbWRWZWwpLmxpbmVhci54ICE9IDAgfHwgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF90d2lzdENtZFZlbCkuYW5ndWxhci56ICE9IDApIHsKICAgICAgICAgICAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KHRoaXMsIF90aW1lclB1Ymxpc2hDbWRWZWwsIHNldEludGVydmFsKCAvKiNfX1BVUkVfXyovX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpczIsIF9hZ3ZyQWN0aW9uKSA9PSBudWxsIHx8IF9jbGFzc1ByaXZhdGVGaWVsZEdldChfdGhpczIsIF90d2lzdENtZFZlbCkgPT0gbnVsbCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMyLCBfYWd2ckFjdGlvbikucHVzaEFjdGlvbih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBBR1ZfQUNUSU9OLk1BTlVBTCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImdlb21ldHJ5X21zZ3MvVHdpc3QiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMyLCBfdHdpc3RDbWRWZWwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmYWxzZSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWUpOwogICAgICAgICAgICAgICAgICB9KSksIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfaW50ZXJ2YWxQdXNoKSkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBwdXNoQ21kdmVsKF94KSB7CiAgICAgICAgcmV0dXJuIF9wdXNoQ21kdmVsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwdXNoQ21kdmVsOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiaW5pdGlhbGl6ZVBvc2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluaXRpYWxpemVQb3NlKCkgewogICAgICB2YXIgYWd2UG9zZSA9IF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfYWd2KS53ZWJQb3NlOwoKICAgICAgdGhpcy5wdXNoQWN0aW9uKHsKICAgICAgICB2YWx1ZTogQUdWX0FDVElPTi5JTklUSUFMX1BPU0UsCiAgICAgICAgdHlwZTogImdlb21ldHJ5X21zZ3MvUG9zZVN0YW1wZWQiLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIGhlYWRlcjogewogICAgICAgICAgICBzZXE6IDAsCiAgICAgICAgICAgIHN0YW1wOiB7CiAgICAgICAgICAgICAgc2VjOiAwLAogICAgICAgICAgICAgIG5zZWM6IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnJhbWVfaWQ6ICcnCiAgICAgICAgICB9LAogICAgICAgICAgcG9zZTogewogICAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICAgIHg6IF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfbWFwKS5yb3NNYXAuaW5mby5vcmlnaW4ucG9zaXRpb24ueCArIGFndlBvc2UucG9zaXRpb24ueCAqIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfbWFwKS5yb3NNYXAuaW5mby5yZXNvbHV0aW9uIC8gX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9tYXApLndlYk1hcC5zY2FsZSwKICAgICAgICAgICAgICB5OiBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX21hcCkucm9zTWFwLmluZm8ub3JpZ2luLnBvc2l0aW9uLnkgLSAoYWd2UG9zZS5wb3NpdGlvbi55IC8gX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9tYXApLndlYk1hcC5zY2FsZSAtIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfbWFwKS5yb3NNYXAuaW5mby5oZWlnaHQpICogX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9tYXApLnJvc01hcC5pbmZvLnJlc29sdXRpb24sCiAgICAgICAgICAgICAgejogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBvcmllbnRhdGlvbjogUk9TMkQuZ2xvYmFsVGhldGFUb1F1YXRlcm5pb24oYWd2UG9zZS5vcmllbnRhdGlvbi56ICogTWF0aC5QSSAvIDE4MCkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInB1c2hBY3Rpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wdXNoQWN0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhhY3Rpb24pIHsKICAgICAgICB2YXIgd2FpdFJlc3VsdCwKICAgICAgICAgICAgX2FyZ3MzID0gYXJndW1lbnRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB3YWl0UmVzdWx0ID0gX2FyZ3MzLmxlbmd0aCA+IDEgJiYgX2FyZ3MzWzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczNbMV0gOiB0cnVlOwoKICAgICAgICAgICAgICAgIGlmICghKF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfYWd2ckFjdGlvbikgPT0gbnVsbCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgbnVsbCk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGlmICh3YWl0UmVzdWx0KSBjb25zb2xlLmxvZygncHVzaCBhY3Rpb24gJywgYWN0aW9uKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIHJldHVybiBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX2FndnJBY3Rpb24pLnB1c2hBY3Rpb24oYWN0aW9uLCB3YWl0UmVzdWx0KTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0My5zZW50KTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcHVzaEFjdGlvbihfeDIpIHsKICAgICAgICByZXR1cm4gX3B1c2hBY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHB1c2hBY3Rpb247CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJsaWZ0VXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9saWZ0VXAgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoQWN0aW9uKHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IEFHVl9BQ1RJT04uTElGVF9VUCwKICAgICAgICAgICAgICAgICAgdHlwZTogImdlb21ldHJ5X21zZ3MvVHdpc3QiLAogICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgbGluZWFyOiB7CiAgICAgICAgICAgICAgICAgICAgICB4OiAwLAogICAgICAgICAgICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgICAgICAgICAgIHo6IDAKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGFuZ3VsYXI6IHsKICAgICAgICAgICAgICAgICAgICAgIHg6IDAsCiAgICAgICAgICAgICAgICAgICAgICB5OiAwLAogICAgICAgICAgICAgICAgICAgICAgejogMAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGxpZnRVcCgpIHsKICAgICAgICByZXR1cm4gX2xpZnRVcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gbGlmdFVwOwogICAgfSgpCiAgfSwgewogICAga2V5OiAibGlmdERvd24iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9saWZ0RG93biA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoKSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hBY3Rpb24oewogICAgICAgICAgICAgICAgICB2YWx1ZTogQUdWX0FDVElPTi5MSUZUX0RPV04sCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJnZW9tZXRyeV9tc2dzL1R3aXN0IiwKICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgIGxpbmVhcjogewogICAgICAgICAgICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgICAgICAgICAgICB6OiAwCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBhbmd1bGFyOiB7CiAgICAgICAgICAgICAgICAgICAgICB4OiAwLAogICAgICAgICAgICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgICAgICAgICAgIHo6IDAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBsaWZ0RG93bigpIHsKICAgICAgICByZXR1cm4gX2xpZnREb3duLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBsaWZ0RG93bjsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImNoYXJnaW5nU3RhcnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9jaGFyZ2luZ1N0YXJ0ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNigpIHsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaEFjdGlvbih7CiAgICAgICAgICAgICAgICAgIHZhbHVlOiBBR1ZfQUNUSU9OLkNIQVJHSU5HX0lOLAogICAgICAgICAgICAgICAgICB0eXBlOiAiZ2VvbWV0cnlfbXNncy9Ud2lzdCIsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBsaW5lYXI6IHsKICAgICAgICAgICAgICAgICAgICAgIHg6IDAsCiAgICAgICAgICAgICAgICAgICAgICB5OiAwLAogICAgICAgICAgICAgICAgICAgICAgejogMAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgYW5ndWxhcjogewogICAgICAgICAgICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgICAgICAgICAgICB6OiAwCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU2LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gY2hhcmdpbmdTdGFydCgpIHsKICAgICAgICByZXR1cm4gX2NoYXJnaW5nU3RhcnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNoYXJnaW5nU3RhcnQ7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJjaGFyZ2luZ0VuZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2NoYXJnaW5nRW5kID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNygpIHsKICAgICAgICB2YXIgYWd2UG9zZSwgYWd2QW5nbGUsIHBvc2VSb3RhdGU7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFndlBvc2UgPSBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX2Fndikuc2ltMTAwMFBvc2U7CiAgICAgICAgICAgICAgICBhZ3ZBbmdsZSA9IGFndlBvc2UucG9zZXlhdyAqIE1hdGguUEkgLyAxODAwMDA7CiAgICAgICAgICAgICAgICBwb3NlUm90YXRlID0gewogICAgICAgICAgICAgICAgICBvcmllbnRhdGlvbjogUk9TMkQuZ2xvYmFsVGhldGFUb1F1YXRlcm5pb24oYWd2QW5nbGUpLAogICAgICAgICAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICAgICAgICAgIHg6IChhZ3ZQb3NlLnBvc2V4ICsgMjAwMCAqIE1hdGguY29zKGFndkFuZ2xlKSkgLyAxMDAwLAogICAgICAgICAgICAgICAgICAgIHk6IChhZ3ZQb3NlLnBvc2V5ICsgMjAwMCAqIE1hdGguc2luKGFndkFuZ2xlKSkgLyAxMDAwLAogICAgICAgICAgICAgICAgICAgIHo6IDAKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hBY3Rpb24oewogICAgICAgICAgICAgICAgICB2YWx1ZTogQUdWX0FDVElPTi5DSEFSR0lOR19PVVQsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJnZW9tZXRyeV9tc2dzL1Bvc2VTdGFtcGVkIiwKICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgIGhlYWRlcjogewogICAgICAgICAgICAgICAgICAgICAgc2VxOiAwLAogICAgICAgICAgICAgICAgICAgICAgc3RhbXA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VjOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBuc2VjOiAwCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgZnJhbWVfaWQ6ICdtYXAnCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBwb3NlOiBwb3NlUm90YXRlCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2hhcmdpbmdFbmQnKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU3LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gY2hhcmdpbmdFbmQoKSB7CiAgICAgICAgcmV0dXJuIF9jaGFyZ2luZ0VuZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gY2hhcmdpbmdFbmQ7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJsaWZ0SW4iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9saWZ0SW4gPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU4KCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOCQoX2NvbnRleHQ4KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoQWN0aW9uKHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IEFHVl9BQ1RJT04uTElGVF9JTiwKICAgICAgICAgICAgICAgICAgdHlwZTogImdlb21ldHJ5X21zZ3MvVHdpc3QiLAogICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgbGluZWFyOiB7CiAgICAgICAgICAgICAgICAgICAgICB4OiAwLAogICAgICAgICAgICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgICAgICAgICAgIHo6IDAKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGFuZ3VsYXI6IHsKICAgICAgICAgICAgICAgICAgICAgIHg6IDAsCiAgICAgICAgICAgICAgICAgICAgICB5OiAwLAogICAgICAgICAgICAgICAgICAgICAgejogMAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGxpZnRJbigpIHsKICAgICAgICByZXR1cm4gX2xpZnRJbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gbGlmdEluOwogICAgfSgpCiAgfSwgewogICAga2V5OiAibGlmdE91dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2xpZnRPdXQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KCkgewogICAgICAgIHZhciBhZ3ZQb3NlLCBhZ3ZBbmdsZSwgcG9zZVJvdGF0ZTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWd2UG9zZSA9IF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfYWd2KS5zaW0xMDAwUG9zZTsKICAgICAgICAgICAgICAgIGFndkFuZ2xlID0gYWd2UG9zZS5wb3NleWF3ICogTWF0aC5QSSAvIDE4MDAwMDsKICAgICAgICAgICAgICAgIHBvc2VSb3RhdGUgPSB7CiAgICAgICAgICAgICAgICAgIG9yaWVudGF0aW9uOiBST1MyRC5nbG9iYWxUaGV0YVRvUXVhdGVybmlvbihhZ3ZBbmdsZSksCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgeDogKGFndlBvc2UucG9zZXggKyAyMDAwICogTWF0aC5jb3MoYWd2QW5nbGUpKSAvIDEwMDAsCiAgICAgICAgICAgICAgICAgICAgeTogKGFndlBvc2UucG9zZXkgKyAyMDAwICogTWF0aC5zaW4oYWd2QW5nbGUpKSAvIDEwMDAsCiAgICAgICAgICAgICAgICAgICAgejogMAogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaEFjdGlvbih7CiAgICAgICAgICAgICAgICAgIHZhbHVlOiBBR1ZfQUNUSU9OLkxJRlRfT1VULAogICAgICAgICAgICAgICAgICB0eXBlOiAiZ2VvbWV0cnlfbXNncy9Qb3NlU3RhbXBlZCIsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBoZWFkZXI6IHsKICAgICAgICAgICAgICAgICAgICAgIHNlcTogMCwKICAgICAgICAgICAgICAgICAgICAgIHN0YW1wOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlYzogMCwKICAgICAgICAgICAgICAgICAgICAgICAgbnNlYzogMAogICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgIGZyYW1lX2lkOiAnbWFwJwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgcG9zZTogcG9zZVJvdGF0ZQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2xpZnRPdXQnKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU5LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gbGlmdE91dCgpIHsKICAgICAgICByZXR1cm4gX2xpZnRPdXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGxpZnRPdXQ7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJydW5Kb2IiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9ydW5Kb2IgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMCgpIHsKICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgdmFyIGpvYiwgbWFwU2NhbGUsIG1hcFJvc0luZm8sIHJlc3VsdCwgZG9uZSwgaSwgdGFzaywgYWd2UG9zZSwgcG9zZSwgcG9zZVJvdGF0ZSwgaiwgYWN0aW9uOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTAkKF9jb250ZXh0MTApIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMC5wcmV2ID0gX2NvbnRleHQxMC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgam9iID0gX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9yb3NTdG9yZSkuc3RhdGUuYWd2Sm9icy5maW5kKGZ1bmN0aW9uIChqKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBqLmlkID09PSBfY2xhc3NQcml2YXRlRmllbGRHZXQoX3RoaXMzLCBfYWd2KS5qb2JJZDsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmICghKGpvYiA9PSBudWxsIHx8IGpvYi50YXNrcy5sZW5ndGggPT0gMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgbWFwU2NhbGUgPSBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX21hcCkud2ViTWFwLnNjYWxlOwogICAgICAgICAgICAgICAgbWFwUm9zSW5mbyA9IF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfbWFwKS5yb3NNYXAuaW5mbzsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IDA7CiAgICAgICAgICAgICAgICBkb25lID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX3Jvc1N0b3JlKS5jb21taXQoImFndnMvc2V0UnVubmluZ1N0YXRlIiwgewogICAgICAgICAgICAgICAgICBhZ3ZJZDogX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9pZCksCiAgICAgICAgICAgICAgICAgIGlzUnVubmdpbmc6IHRydWUKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGkgPSAwOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBpZiAoIShpIDwgam9iLnRhc2tzLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gNTY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRhc2sgPSBqb2IudGFza3NbaV07CgogICAgICAgICAgICAgICAgX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9yb3NTdG9yZSkuY29tbWl0KCJhZ3ZzL3NldEFndlRhc2siLCB7CiAgICAgICAgICAgICAgICAgIGFndklkOiBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX2lkKSwKICAgICAgICAgICAgICAgICAgdGFza0lkOiB0YXNrLmlkCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBhZ3ZQb3NlID0gX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHRoaXMsIF9hZ3YpLnNpbTEwMDBQb3NlOwogICAgICAgICAgICAgICAgcG9zZSA9IHsKICAgICAgICAgICAgICAgICAgb3JpZW50YXRpb246IFJPUzJELmdsb2JhbFRoZXRhVG9RdWF0ZXJuaW9uKHRhc2sudGhldGFFbmQgKiBNYXRoLlBJIC8gMTgwKSwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgICAgICAgICB4OiBtYXBSb3NJbmZvLm9yaWdpbi5wb3NpdGlvbi54ICsgdGFzay5wb3NpdGlvbi54ICogbWFwUm9zSW5mby5yZXNvbHV0aW9uIC8gbWFwU2NhbGUsCiAgICAgICAgICAgICAgICAgICAgeTogbWFwUm9zSW5mby5vcmlnaW4ucG9zaXRpb24ueSAtICh0YXNrLnBvc2l0aW9uLnkgLyBtYXBTY2FsZSAtIG1hcFJvc0luZm8uaGVpZ2h0KSAqIG1hcFJvc0luZm8ucmVzb2x1dGlvbiwKICAgICAgICAgICAgICAgICAgICB6OiAwCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBwb3NlUm90YXRlID0gewogICAgICAgICAgICAgICAgICBvcmllbnRhdGlvbjogUk9TMkQuZ2xvYmFsVGhldGFUb1F1YXRlcm5pb24oTWF0aC5hdGFuMihwb3NlLnBvc2l0aW9uLnkgLSBhZ3ZQb3NlLnBvc2V5IC8gMTAwMCwgcG9zZS5wb3NpdGlvbi54IC0gYWd2UG9zZS5wb3NleCAvIDEwMDApKSwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHsKICAgICAgICAgICAgICAgICAgICB4OiBhZ3ZQb3NlLnBvc2V4IC8gMTAwMCwKICAgICAgICAgICAgICAgICAgICB5OiBhZ3ZQb3NlLnBvc2V5IC8gMTAwMCwKICAgICAgICAgICAgICAgICAgICB6OiAwCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAxNzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnB1c2hBY3Rpb24oewogICAgICAgICAgICAgICAgICB2YWx1ZTogQUdWX0FDVElPTi5ST1RBVEVfR09BTCwKICAgICAgICAgICAgICAgICAgdHlwZTogImdlb21ldHJ5X21zZ3MvUG9zZVN0YW1wZWQiLAogICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiB7CiAgICAgICAgICAgICAgICAgICAgICBzZXE6IDAsCiAgICAgICAgICAgICAgICAgICAgICBzdGFtcDogewogICAgICAgICAgICAgICAgICAgICAgICBzZWM6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG5zZWM6IDAKICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICBmcmFtZV9pZDogJ21hcCcKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHBvc2U6IHBvc2VSb3RhdGUKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgICByZXN1bHQgPSBfY29udGV4dDEwLnNlbnQ7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzdWx0IGFjdGlvbiByb3RhdGUgPSAnLCByZXN1bHQpOwogICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAhPSBBR1ZfQUNUSU9OX1NUQVRVUy5TVUNDRUVERUQpIGRvbmUgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBpZiAoZG9uZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAyMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJicmVhayIsIDU2KTsKCiAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDI0OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVzaEFjdGlvbih7CiAgICAgICAgICAgICAgICAgIHZhbHVlOiBBR1ZfQUNUSU9OLk1PVkVfR09BTCwKICAgICAgICAgICAgICAgICAgdHlwZTogImdlb21ldHJ5X21zZ3MvUG9zZVN0YW1wZWQiLAogICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVyOiB7CiAgICAgICAgICAgICAgICAgICAgICBzZXE6IDAsCiAgICAgICAgICAgICAgICAgICAgICBzdGFtcDogewogICAgICAgICAgICAgICAgICAgICAgICBzZWM6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG5zZWM6IDAKICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICBmcmFtZV9pZDogJ21hcCcKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHBvc2U6IHBvc2UKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgICByZXN1bHQgPSBfY29udGV4dDEwLnNlbnQ7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzdWx0IGFjdGlvbiBtb3ZlIGdvYWwgPSAnLCByZXN1bHQpOwogICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAhPSBBR1ZfQUNUSU9OX1NUQVRVUy5TVUNDRUVERUQpIGRvbmUgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBpZiAoZG9uZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAyOTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJicmVhayIsIDU2KTsKCiAgICAgICAgICAgICAgY2FzZSAyOToKICAgICAgICAgICAgICAgIGogPSAwOwoKICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgaWYgKCEoaiA8IHRhc2suYWN0aW9ucy5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDUxOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBhY3Rpb24gPSB0YXNrLmFjdGlvbnNbal07CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLnQwID0gYWN0aW9uLmFjdGlvbjsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IF9jb250ZXh0MTAudDAgPT09IEFHVl9BQ1RJT04uQ0hBUkdJTkdfT1VUID8gMzUgOiBfY29udGV4dDEwLnQwID09PSBBR1ZfQUNUSU9OLkxJRlRfT1VUID8gMzggOiBfY29udGV4dDEwLnQwID09PSBBR1ZfQUNUSU9OLkNIQVJHSU5HX0lOID8gNDEgOiBfY29udGV4dDEwLnQwID09PSBBR1ZfQUNUSU9OLkxJRlRfSU4gPyA0MSA6IF9jb250ZXh0MTAudDAgPT09IEFHVl9BQ1RJT04uTElGVF9VUCA/IDQxIDogX2NvbnRleHQxMC50MCA9PT0gQUdWX0FDVElPTi5MSUZUX0RPV04gPyA0MSA6IDQ2OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMzU6CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAzNzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoYXJnaW5nRW5kKCk7CgogICAgICAgICAgICAgIGNhc2UgMzc6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoImJyZWFrIiwgNDYpOwoKICAgICAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gNDA7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5saWZ0T3V0KCk7CgogICAgICAgICAgICAgIGNhc2UgNDA6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoImJyZWFrIiwgNDYpOwoKICAgICAgICAgICAgICBjYXNlIDQxOgogICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gNDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wdXNoQWN0aW9uKHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IGFjdGlvbi5hY3Rpb24sCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJnZW9tZXRyeV9tc2dzL1Bvc2VTdGFtcGVkIiwKICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgIGhlYWRlcjogewogICAgICAgICAgICAgICAgICAgICAgc2VxOiAwLAogICAgICAgICAgICAgICAgICAgICAgc3RhbXA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VjOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBuc2VjOiAwCiAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgZnJhbWVfaWQ6ICdtYXAnCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBwb3NlOiBwb3NlCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDQzOgogICAgICAgICAgICAgICAgcmVzdWx0ID0gX2NvbnRleHQxMC5zZW50OwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Jlc3VsdCBhY3Rpb24gZG9pbmcgYWN0aW9uICcsIGFjdGlvbi5uYW1lLCAiID0gIiwgcmVzdWx0KTsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgIT0gQUdWX0FDVElPTl9TVEFUVVMuU1VDQ0VFREVEKSBkb25lID0gZmFsc2U7CgogICAgICAgICAgICAgIGNhc2UgNDY6CiAgICAgICAgICAgICAgICBpZiAoZG9uZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA0ODsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJicmVhayIsIDUxKTsKCiAgICAgICAgICAgICAgY2FzZSA0ODoKICAgICAgICAgICAgICAgIGorKzsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDMwOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgNTE6CiAgICAgICAgICAgICAgICBpZiAoZG9uZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA1MzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJicmVhayIsIDU2KTsKCiAgICAgICAgICAgICAgY2FzZSA1MzoKICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA1NjoKICAgICAgICAgICAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfcm9zU3RvcmUpLmNvbW1pdCgiYWd2cy9zZXRSdW5uaW5nU3RhdGUiLCB7CiAgICAgICAgICAgICAgICAgIGFndklkOiBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX2lkKSwKICAgICAgICAgICAgICAgICAgaXNSdW5uZ2luZzogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChkb25lKSB7CiAgICAgICAgICAgICAgICAgIF9jbGFzc1ByaXZhdGVGaWVsZEdldCh0aGlzLCBfcm9zU3RvcmUpLmNvbW1pdCgiYWd2Sm9icy9jbGVhclRhc2tGcm9tSm9iIiwgewogICAgICAgICAgICAgICAgICAgIGpvYklkOiBfY2xhc3NQcml2YXRlRmllbGRHZXQodGhpcywgX2Fndikuam9iSWQKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgNTg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHJ1bkpvYigpIHsKICAgICAgICByZXR1cm4gX3J1bkpvYi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcnVuSm9iOwogICAgfSgpCiAgfV0pOwoKICByZXR1cm4gQWd2clJvYm90Owp9KCk7CgpleHBvcnQgeyBBZ3ZyUm9ib3QgYXMgZGVmYXVsdCB9Ow=="},{"version":3,"sources":["/home/robotics/TungNV/agv_v2_ws/src/agv_v2/webServer/agv-dasboard/src/services/agvr/agvr-robot.js"],"names":["ROSLIB","Vue","AgvrDiagnostics","AgvrAction","AgvrSim1000Pose","ROS2D","AGV_ACTION_STATUS","AGV_ACTION","AgvrRobot","id","mapId","Ros","url","on","e","console","log","commit","agvId","isConnected","dispose","setTimeout","prototype","$store","state","agvMaps","find","m","agvs","r","rosMasterUri","twist","speed","properties","linear","x","movementSpeed","y","z","angular","rotateSpeed","clearInterval","pushAction","value","MANUAL","type","data","setInterval","agvPose","webPose","INITIAL_POSE","header","seq","stamp","sec","nsec","frame_id","pose","position","rosMap","info","origin","resolution","webMap","scale","height","orientation","globalThetaToQuaternion","Math","PI","action","waitResult","LIFT_UP","LIFT_DOWN","CHARGING_IN","sim1000Pose","agvAngle","poseyaw","poseRotate","posex","cos","posey","sin","CHARGING_OUT","LIFT_IN","LIFT_OUT","job","agvJobs","j","jobId","tasks","length","mapScale","mapRosInfo","result","done","isRunnging","i","task","taskId","thetaEnd","atan2","ROTATE_GOAL","SUCCEEDED","MOVE_GOAL","actions","chargingEnd","liftOut","name"],"mappings":"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","sourcesContent":["import ROSLIB from \"roslib\";\nimport Vue from \"vue\";\nimport AgvrDiagnostics from \"./agvr-diagnostics\";\nimport AgvrAction from \"./agvr-action\";\nimport AgvrSim1000Pose from \"./agvr-sim1000-pose\";\nimport { ROS2D } from '@/utils/ros';\nimport * as AGV_ACTION_STATUS from './agv-action-status';\nimport * as AGV_ACTION from \"./agv-action-type\";\n\nexport default class AgvrRobot {\n  #id = null;\n  #agv = null;\n  #mapId = null;\n  #map = null;\n  #ros = null;\n  #rosUrl = null;\n  #rosStore = null;\n\n  #agvrDiagnostics = null;\n  #agvrAction = null;\n  #agvrSim1000Pose = null;\n\n  #twistCmdVel = null;\n  #timerPublishCmdVel = null;\n  #intervalPush = 100;\n\n  constructor(id, mapId) {\n    this.#id = id;\n    this.#mapId = mapId;\n    this.#rosStore = Vue.prototype.$store;\n    this.#map = this.#rosStore.state.agvMaps.find((m) => m.id === mapId);\n    this.#agv = this.#rosStore.state.agvs.find((r) => r.id === this.#id);\n    this.#rosUrl = this.#agv.rosMasterUri;\n    this.#rosConnect();\n  }\n\n  #rosConnect = () => {\n    this.#ros = new ROSLIB.Ros({ url: this.#rosUrl });\n    this.#ros.on(\"connection\", this.#onRosConnected);\n    this.#ros.on(\"close\", this.#onRosDisconnected);\n    this.#ros.on(\"error\", (e) => console.log(\"AGVR error: \", e));\n  }\n\n  #onRosConnected = () => {\n    this.#agvrAction = new AgvrAction(this.#ros);\n    this.#agvrDiagnostics = new AgvrDiagnostics(this.#ros, this.#id);\n    this.#agvrSim1000Pose = new AgvrSim1000Pose(this.#ros, this.#id, this.#mapId);\n\n    this.#rosStore.commit(\"agvs/setConnectionState\", {\n      agvId: this.#id,\n      isConnected: true,\n    })\n  }\n\n  #onRosDisconnected = () => {\n    if (this.#agvrDiagnostics != null) {\n      this.#agvrDiagnostics.dispose();\n      this.#agvrDiagnostics = null;\n    }\n    if (this.#agvrAction != null) {\n      this.#agvrAction.dispose();\n      this.#agvrAction = null;\n    }\n    if (this.#agvrSim1000Pose != null) {\n      this.#agvrSim1000Pose.dispose();\n      this.#agvrSim1000Pose = null;\n    }\n\n    this.#rosStore.commit(\"agvs/setConnectionState\", {\n      agvId: this.#id,\n      isConnected: false,\n    });\n\n    setTimeout(this.#rosConnect, 3000);\n  }\n\n  async pushCmdvel(twist) {\n    if (twist == null) return;\n\n    let speed = this.#agv.properties;\n    this.#twistCmdVel = {\n      linear: {\n        x: twist.linear.x * speed.movementSpeed.x,\n        y: twist.linear.y * speed.movementSpeed.y,\n        z: twist.linear.z * speed.movementSpeed.z,\n      },\n      angular: {\n        x: twist.angular.x * speed.rotateSpeed.x,\n        y: twist.angular.y * speed.rotateSpeed.y,\n        z: twist.angular.z * speed.rotateSpeed.z,\n      },\n    };\n\n    if (this.#timerPublishCmdVel != null) clearInterval(this.#timerPublishCmdVel);\n    await this.pushAction({\n      value: AGV_ACTION.MANUAL,\n      type: \"geometry_msgs/Twist\",\n      data: this.#twistCmdVel,\n    }, false);\n\n    if (this.#twistCmdVel.linear.x != 0 || this.#twistCmdVel.angular.z != 0) {\n      this.#timerPublishCmdVel = setInterval(async () => {\n        if (this.#agvrAction == null || this.#twistCmdVel == null) return;\n        await this.#agvrAction.pushAction({\n          value: AGV_ACTION.MANUAL,\n          type: \"geometry_msgs/Twist\",\n          data: this.#twistCmdVel,\n        }, false);\n      }, this.#intervalPush);\n    }\n  }\n\n  initializePose() {\n    let agvPose = this.#agv.webPose;\n    this.pushAction({\n      value: AGV_ACTION.INITIAL_POSE,\n      type: \"geometry_msgs/PoseStamped\",\n      data: {\n        header: {\n          seq: 0,\n          stamp: {\n            sec: 0,\n            nsec: 0,\n          },\n          frame_id: '',\n        },\n        pose: {\n          position: {\n            x: this.#map.rosMap.info.origin.position.x + agvPose.position.x * this.#map.rosMap.info.resolution / this.#map.webMap.scale,\n            y: this.#map.rosMap.info.origin.position.y - ((agvPose.position.y / this.#map.webMap.scale) - this.#map.rosMap.info.height) * this.#map.rosMap.info.resolution,\n            z: 0,\n          },\n          orientation: ROS2D.globalThetaToQuaternion(agvPose.orientation.z * Math.PI / 180),\n        }\n      },\n    })\n  }\n\n  async pushAction(action, waitResult = true) {\n    if (this.#agvrAction == null) return null;\n\n    if(waitResult) console.log('push action ', action);\n    return await this.#agvrAction.pushAction(action, waitResult);\n  }\n\n  async liftUp() {\n    await this.pushAction({\n      value: AGV_ACTION.LIFT_UP,\n      type: \"geometry_msgs/Twist\",\n      data: {\n        linear: {\n          x: 0,\n          y: 0,\n          z: 0,\n        },\n        angular: {\n          x: 0,\n          y: 0,\n          z: 0,\n        },\n      },\n    })\n  }\n\n  async liftDown() {\n    await this.pushAction({\n      value: AGV_ACTION.LIFT_DOWN,\n      type: \"geometry_msgs/Twist\",\n      data: {\n        linear: { x: 0, y: 0, z: 0, },\n        angular: { x: 0, y: 0, z: 0, },\n      },\n    })\n  }\n\n  async chargingStart() {\n    await this.pushAction({\n      value: AGV_ACTION.CHARGING_IN,\n      type: \"geometry_msgs/Twist\",\n      data: {\n        linear: { x: 0, y: 0, z: 0, },\n        angular: { x: 0, y: 0, z: 0, },\n      },\n    })\n  }\n\n  async chargingEnd() {\n    let agvPose = this.#agv.sim1000Pose;\n    let agvAngle = agvPose.poseyaw * Math.PI / 180000;\n    let poseRotate = {\n      orientation: ROS2D.globalThetaToQuaternion(agvAngle),\n      position: {\n        x: (agvPose.posex + 2000 * Math.cos(agvAngle)) / 1000,\n        y: (agvPose.posey + 2000 * Math.sin(agvAngle)) / 1000,\n        z: 0,\n      },\n    };\n    \n    await this.pushAction({\n      value: AGV_ACTION.CHARGING_OUT,\n      type: \"geometry_msgs/PoseStamped\",\n      data: {\n        header: {\n          seq: 0,\n          stamp: {\n            sec: 0,\n            nsec: 0,\n          },\n          frame_id: 'map',\n        },\n        pose: poseRotate,\n      },\n    });\n    console.log('chargingEnd');\n  }\n\n  async liftIn() {\n    await this.pushAction({\n      value: AGV_ACTION.LIFT_IN,\n      type: \"geometry_msgs/Twist\",\n      data: {\n        linear: { x: 0, y: 0, z: 0, },\n        angular: { x: 0, y: 0, z: 0, },\n      },\n    })\n  }\n\n  async liftOut() {\n    let agvPose = this.#agv.sim1000Pose;\n    let agvAngle = agvPose.poseyaw * Math.PI / 180000;\n    let poseRotate = {\n      orientation: ROS2D.globalThetaToQuaternion(agvAngle),\n      position: {\n        x: (agvPose.posex + 2000 * Math.cos(agvAngle)) / 1000,\n        y: (agvPose.posey + 2000 * Math.sin(agvAngle)) / 1000,\n        z: 0,\n      },\n    };\n    \n    await this.pushAction({\n      value: AGV_ACTION.LIFT_OUT,\n      type: \"geometry_msgs/PoseStamped\",\n      data: {\n        header: {\n          seq: 0,\n          stamp: {\n            sec: 0,\n            nsec: 0,\n          },\n          frame_id: 'map',\n        },\n        pose: poseRotate,\n      },\n    });\n    console.log('liftOut');\n  }\n\n  async runJob() {\n    let job = this.#rosStore.state.agvJobs.find(j => j.id === this.#agv.jobId);\n    if (job == null || job.tasks.length == 0) return;\n\n    let mapScale = this.#map.webMap.scale;\n    let mapRosInfo = this.#map.rosMap.info;\n    let result = 0;\n    let done = true;\n    this.#rosStore.commit(\"agvs/setRunningState\", {\n      agvId: this.#id,\n      isRunnging: true,\n    });\n    for (var i = 0; i < job.tasks.length; i++) {\n      let task = job.tasks[i];\n      this.#rosStore.commit(\"agvs/setAgvTask\", {\n        agvId: this.#id,\n        taskId: task.id,\n      })\n\n      let agvPose = this.#agv.sim1000Pose;\n      let pose = {\n        orientation: ROS2D.globalThetaToQuaternion(task.thetaEnd * Math.PI / 180),\n        position: {\n          x: mapRosInfo.origin.position.x + task.position.x * mapRosInfo.resolution / mapScale,\n          y: mapRosInfo.origin.position.y - ((task.position.y / mapScale) - mapRosInfo.height) * mapRosInfo.resolution,\n          z: 0,\n        },\n      };\n      let poseRotate = {\n        orientation: ROS2D.globalThetaToQuaternion(Math.atan2(pose.position.y - agvPose.posey / 1000, pose.position.x - agvPose.posex / 1000)),\n        position: {\n          x: agvPose.posex / 1000,\n          y: agvPose.posey / 1000,\n          z: 0,\n        },\n      };\n      result = await this.pushAction({\n        value: AGV_ACTION.ROTATE_GOAL,\n        type: \"geometry_msgs/PoseStamped\",\n        data: {\n          header: {\n            seq: 0,\n            stamp: {\n              sec: 0,\n              nsec: 0,\n            },\n            frame_id: 'map',\n          },\n          pose: poseRotate,\n        },\n      });\n      console.log('result action rotate = ', result);\n      if(result != AGV_ACTION_STATUS.SUCCEEDED) done = false;\n      if(!done) break;\n\n      result = await this.pushAction({\n        value: AGV_ACTION.MOVE_GOAL,\n        type: \"geometry_msgs/PoseStamped\",\n        data: {\n          header: { \n            seq: 0, \n            stamp: {\n              sec: 0,\n              nsec: 0,\n            }, \n            frame_id: 'map', \n          },\n          pose,\n        },\n      });\n      console.log('result action move goal = ', result);\n      if(result != AGV_ACTION_STATUS.SUCCEEDED) done = false;\n      if(!done) break;\n\n      for(let j = 0; j < task.actions.length; j++) {\n        let action = task.actions[j];\n        switch(action.action) {\n          case AGV_ACTION.CHARGING_OUT:\n            await this.chargingEnd();\n            break;\n          case AGV_ACTION.LIFT_OUT:\n            await this.liftOut();\n            break;\n          case AGV_ACTION.CHARGING_IN:\n          case AGV_ACTION.LIFT_IN:\n          case AGV_ACTION.LIFT_UP:\n          case AGV_ACTION.LIFT_DOWN:\n            result = await this.pushAction({\n              value: action.action,\n              type: \"geometry_msgs/PoseStamped\",\n              data: {\n                header: { \n                  seq: 0, \n                  stamp: {\n                    sec: 0,\n                    nsec: 0,\n                  }, \n                  frame_id: 'map', \n                },\n                pose,\n              },\n            });\n            console.log('result action doing action ', action.name, \" = \", result);\n            if(result != AGV_ACTION_STATUS.SUCCEEDED) done = false;\n        }\n        if(!done) break;\n      }\n      if(!done) break;\n    }\n    this.#rosStore.commit(\"agvs/setRunningState\", {\n      agvId: this.#id,\n      isRunnging: false,\n    });\n    if(done) {\n      this.#rosStore.commit(\"agvJobs/clearTaskFromJob\", {jobId: this.#agv.jobId});\n    }\n  }\n}"]}]}